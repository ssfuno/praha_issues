# 課題
データベースモデリング3

# 目的
- 論理・物理設計のレビューをお願いしたいです
- グラフDBでも実装してみたいのですが、時間がかかりそうなので先にMySQLでの実装を見ていただきたいです

# 仕様（課題より抜粋）
- ドキュメント
    - いつ、誰が、どんなテキスト情報を保存したのか管理する
    - ドキュメントは必ず何らかのディレクトリに属する
- ディレクトリ
    - 一つ以上のドキュメントを含む階層構造
    - ディレクトリは無制限にサブディレクトリを持つことができる
    - ディレクトリ構造は柔軟に変更可能。ディレクトリが移動してサブディレクトリになることもあり得る
- ユーザ
    - ドキュメントをCRUD（作成、参照、更新、削除）できる
    - ディレクトリをCRUDできる

# 結論
## エンティティの抽出
- ドキュメント
- ディレクトリ
- ユーザ

# 考えたこと
## 階層構造の表現方法
下記のとおり検討し、MySQLでの隣接リストおよび、グラフDBのNeo4jで実装する方針とした

https://mercury-makemake-898.notion.site/DB-3-1a22e0e453f0804a9c14c31dc68ed842

## 履歴情報の表現方法
### MySQLの場合
- ユーザ：論理削除
    - ドキュメントの作成者を表示する際、削除されたユーザ名も表示できるようにしたい
    - 変更履歴は不要
- ディレクトリ：物理削除
    - 削除後復元できなくても問題ないと考えた
    - 変更履歴は不要
- ドキュメント：バージョン管理用のテーブルを用意
    - 過去のバージョンを復元できるようにしたい
    - 削除後一定期間は復元できるようにしたい
    - 同じテーブルだとデータ量が大きくなりすぎる
    - 他に検討した設計
        - 履歴用のテーブルを用意
            - 論理削除が不要になる。ただしユーザテーブルが論理削除なので、ドキュメントテーブルも論理削除で揃えたほうが分かりやすいかもしれない
            - 作成時は元のテーブルと履歴テーブルにINSERT、更新時は元のテーブルでUPDATE&履歴テーブルにINSERT、削除時は元のテーブルでDELETE&履歴テーブルにINSERT、と複雑になる（元のテーブルに全てINSERTする場合、参照するテーブルが増えた場合の拡張性が心配）
        - json型として保存
            - アプリケーション側のロジックがやや複雑になることを許容できれば、選択肢になりそう
### Neo4jの場合（作成中）
- 論理削除については同様の考えで設計
- ドキュメントの履歴管理については、ディレクトリ→最新のドキュメント→前バージョンのドキュメント→前々バージョンのドキュメント、という形で各ノード間にリレーションを設定する

# メンバーに確認・相談したい内容
- 下記について特にご意見いただきたいです！
    - 階層構造の表現方法
    - 履歴情報の表現方法
